<!-- templates/base.html -->
<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>–ü–æ–∏—Å–∫ DFO –ø–æ –¥–∞—Ç–∞–º</title>
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 40px; }
        .form-group { margin: 10px 0; }
        label { margin-right: 10px; }
        input[type="date"] { padding: 5px; }
        button { padding: 8px 16px; background: #007bff; color: white; border: none; cursor: pointer; }
        button:hover { background: #0056b3; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f4f4f4; }
        .error { color: red; margin: 10px 0; }
        .info { color: green; margin: 10px 0; }
        .chart-container {
            margin-top: 30px;
            max-width: 800px;
            height: 400px;
        }
    </style>
</head>
<body>
    <h1>–ü–æ–∏—Å–∫ –¥–∞–Ω–Ω—ã—Ö DFO –ø–æ –¥–∏–∞–ø–∞–∑–æ–Ω—É –¥–∞—Ç</h1>

    <!-- –§–æ—Ä–º–∞ –ø–æ–∏—Å–∫–∞ -->
    <form method="get" action="/dfo-results">
        <div class="form-group">
            <label for="batch_date_start">–ù–∞—á–∞–ª—å–Ω–∞—è –¥–∞—Ç–∞:</label>
            <input 
                type="date" 
                name="batch_date_start" 
                id="batch_date_start" 
                value="{{ batch_date_start }}"
                required>
            
            <label for="batch_date_end">–ö–æ–Ω–µ—á–Ω–∞—è –¥–∞—Ç–∞:</label>
            <input 
                type="date" 
                name="batch_date_end" 
                id="batch_date_end" 
                value="{{ batch_date_end }}"
                required>
            
            <button type="submit">üîç –ü–æ–∏—Å–∫</button>
        </div>
    </form>

    <!-- –û—à–∏–±–∫–∏ -->
    {% if error %}
        <div class="error"><strong>–û—à–∏–±–∫–∞:</strong> {{ error }}</div>
    {% endif %}

    <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã -->
    {% if info %}
        {% if results_found %}
            <div class="info">–ù–∞–π–¥–µ–Ω–æ –∑–∞–ø–∏—Å–µ–π: {{ info | length }}</div>

            <!-- –¢–∞–±–ª–∏—Ü–∞ -->
            <table>
                <thead>
                    <tr>
                        <th>–î–∞—Ç–∞</th>
                        <th>–ó–Ω–∞—á–µ–Ω–∏–µ</th>
                        <!-- –î–æ–±–∞–≤—å—Ç–µ –¥—Ä—É–≥–∏–µ –ø–æ–ª—è –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ -->
                    </tr>
                </thead>
                <tbody>
                    {% for row in info %}
                    <tr>
                        <td>{{ row.batch_date }}</td>
                        <td>{{ row.value }}</td> <!-- –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ —É –≤–∞—Å –µ—Å—Ç—å –ø–æ–ª–µ `value` -->
                    </tr>
                    {% endfor %}
                </tbody>
            </table>

            <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –¥–ª—è –≥—Ä–∞—Ñ–∏–∫–∞ -->
            <div class="chart-container">
                <canvas id="dfoChart"></canvas>
            </div>

            <!-- –°–∫—Ä–∏–ø—Ç –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞ -->
            <script>
                const ctx = document.getElementById('dfoChart').getContext('2d');

                // –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö
                const dates = [{% for row in info %}"{{ row.batch_date }}",{% endfor %}];
                const values = [{% for row in info %}{{ row.value }},{% endfor %}];

                new Chart(ctx, {
                    type: 'line',
                    data: {
                        labels: dates,
                        datasets: [{
                            label: '–ó–Ω–∞—á–µ–Ω–∏–µ DFO',
                            data: values,
                            borderColor: 'rgba(54, 162, 235, 1)',
                            backgroundColor: 'rgba(54, 162, 235, 0.2)',
                            borderWidth: 2,
                            pointRadius: 4,
                            tension: 0.3  // –ø–ª–∞–≤–Ω—ã–µ –ª–∏–Ω–∏–∏
                        }]
                    },
                    options: {
                        responsive: true,
                        plugins: {
                            legend: { position: 'top' },
                            title: {
                                display: true,
                                text: 'DFO –ø–æ –¥–∞—Ç–∞–º'
                            }
                        },
                        scales: {
                            x: {
                                title: { display: true, text: '–î–∞—Ç–∞' }
                            },
                            y: {
                                title: { display: true, text: '–ó–Ω–∞—á–µ–Ω–∏–µ' },
                                beginAtZero: false
                            }
                        }
                    }
                });
            </script>
        {% else %}
            <p><em>–î–∞–Ω–Ω—ã–µ –∑–∞ –≤—ã–±—Ä–∞–Ω–Ω—ã–π –ø–µ—Ä–∏–æ–¥ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã.</em></p>
        {% endif %}
    {% endif %}

</body>
</html>